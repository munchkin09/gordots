[gd_scene load_steps=49 format=3 uid="uid://bimqvxarfp4xy"]

[ext_resource type="Texture2D" uid="uid://kysvg1i2dav" path="res://Assets/Sprites/knight.png" id="1_hdtba"]
[ext_resource type="AudioStream" uid="uid://ceml0dwvoiw5l" path="res://Assets/time_for_adventure.mp3" id="2_fxw2h"]
[ext_resource type="Script" path="res://src/Scripts/HealthController.gd" id="3_3k4ky"]

[sub_resource type="GDScript" id="GDScript_ngihq"]
resource_name = "PlayerInputController"
script/source = "extends CharacterBody2D

signal start
signal hit

const SPEED = 120
const JUMP_VELOCITY = -500
var faceLeft = true
@onready var animated_sprite = $AnimatedSprite2D

# Get the gravity from the project settings to be synced with RigidBody nodes.
var gravity = ProjectSettings.get_setting(\"physics/2d/default_gravity\")

func _ready():
	start.emit()

func _physics_process(delta):
	animated_sprite.pause()
	# Add the gravity.
	if not is_on_floor():
		animated_sprite.play()
		velocity.y += gravity * delta
		

	# Handle jump.
	if Input.is_action_just_pressed(\"ui_accept\") and is_on_floor():
		velocity.y = JUMP_VELOCITY
		return

	# Get the input direction and handle the movement/deceleration.
	# As good practice, you should replace UI actions with custom gameplay actions.
	var direction = Input.get_axis(\"ui_left\", \"ui_right\")
	if direction:
		animated_sprite.flip_h = false if (direction == 1) else true
		animated_sprite.play(\"run\")
		velocity.x = direction * SPEED
	else:
		animated_sprite.play(\"idle\")
		velocity.x = move_toward(velocity.x, 0, SPEED)
	move_and_slide()


# Listener del evento de impacto de una bala al Player
func _on_gun_impact():
	hit.emit()
"

[sub_resource type="GDScript" id="GDScript_lmkjx"]
resource_name = "CameraEvents"
script/source = "extends Camera2D

var startZooming = false

# Called every frame. 'delta' is the elapsed time since the previous frame.
func _process(_delta):
	if(startZooming && self.zoom <= Vector2(3,3)):
		var actualZoom = self.zoom
		self.zoom = Vector2(actualZoom.x + (0.4 * _delta), actualZoom.y + (0.4 * _delta))
	else:
		startZooming = false
func _on_timer_timeout():
	startZooming = true
"

[sub_resource type="RectangleShape2D" id="RectangleShape2D_1mewk"]
size = Vector2(13, 19)

[sub_resource type="AtlasTexture" id="AtlasTexture_dihdx"]
atlas = ExtResource("1_hdtba")
region = Rect2(0, 224, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_ywqbq"]
atlas = ExtResource("1_hdtba")
region = Rect2(32, 224, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_8oy88"]
atlas = ExtResource("1_hdtba")
region = Rect2(64, 224, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_rrkg0"]
atlas = ExtResource("1_hdtba")
region = Rect2(96, 224, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_6utkj"]
atlas = ExtResource("1_hdtba")
region = Rect2(0, 192, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_tsu2y"]
atlas = ExtResource("1_hdtba")
region = Rect2(32, 192, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_sly08"]
atlas = ExtResource("1_hdtba")
region = Rect2(64, 192, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_8k4hb"]
atlas = ExtResource("1_hdtba")
region = Rect2(96, 192, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_exfyq"]
atlas = ExtResource("1_hdtba")
region = Rect2(0, 0, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_atrpq"]
atlas = ExtResource("1_hdtba")
region = Rect2(32, 0, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_431al"]
atlas = ExtResource("1_hdtba")
region = Rect2(64, 0, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_wr21q"]
atlas = ExtResource("1_hdtba")
region = Rect2(96, 0, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_vgcly"]
atlas = ExtResource("1_hdtba")
region = Rect2(0, 160, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_am7gf"]
atlas = ExtResource("1_hdtba")
region = Rect2(32, 160, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_dl7y1"]
atlas = ExtResource("1_hdtba")
region = Rect2(64, 160, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_k8ndx"]
atlas = ExtResource("1_hdtba")
region = Rect2(96, 160, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_n4qa5"]
atlas = ExtResource("1_hdtba")
region = Rect2(128, 160, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_dpvvu"]
atlas = ExtResource("1_hdtba")
region = Rect2(160, 160, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_3uovp"]
atlas = ExtResource("1_hdtba")
region = Rect2(192, 160, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_dirde"]
atlas = ExtResource("1_hdtba")
region = Rect2(224, 160, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_eeckv"]
atlas = ExtResource("1_hdtba")
region = Rect2(0, 0, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_73fcm"]
atlas = ExtResource("1_hdtba")
region = Rect2(32, 0, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_amgoj"]
atlas = ExtResource("1_hdtba")
region = Rect2(64, 0, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_dl8hg"]
atlas = ExtResource("1_hdtba")
region = Rect2(96, 0, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_7gbg6"]
atlas = ExtResource("1_hdtba")
region = Rect2(0, 64, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_fi51b"]
atlas = ExtResource("1_hdtba")
region = Rect2(32, 64, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_cvy7i"]
atlas = ExtResource("1_hdtba")
region = Rect2(64, 64, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_52t2v"]
atlas = ExtResource("1_hdtba")
region = Rect2(96, 64, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_vf7ab"]
atlas = ExtResource("1_hdtba")
region = Rect2(128, 64, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_hd66r"]
atlas = ExtResource("1_hdtba")
region = Rect2(160, 64, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_7mdq6"]
atlas = ExtResource("1_hdtba")
region = Rect2(192, 64, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_ttng0"]
atlas = ExtResource("1_hdtba")
region = Rect2(224, 64, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_vccwk"]
atlas = ExtResource("1_hdtba")
region = Rect2(0, 96, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_e8esa"]
atlas = ExtResource("1_hdtba")
region = Rect2(32, 96, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_p4ckx"]
atlas = ExtResource("1_hdtba")
region = Rect2(64, 96, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_vlntg"]
atlas = ExtResource("1_hdtba")
region = Rect2(96, 96, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_tv0i6"]
atlas = ExtResource("1_hdtba")
region = Rect2(128, 96, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_uj4sv"]
atlas = ExtResource("1_hdtba")
region = Rect2(160, 96, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_1hdpg"]
atlas = ExtResource("1_hdtba")
region = Rect2(192, 96, 32, 32)

[sub_resource type="AtlasTexture" id="AtlasTexture_ox8pr"]
atlas = ExtResource("1_hdtba")
region = Rect2(224, 96, 32, 32)

[sub_resource type="SpriteFrames" id="SpriteFrames_vulta"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_dihdx")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ywqbq")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_8oy88")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_rrkg0")
}],
"loop": true,
"name": &"death",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_6utkj")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_tsu2y")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_sly08")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_8k4hb")
}],
"loop": true,
"name": &"hit",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_exfyq")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_atrpq")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_431al")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_wr21q")
}],
"loop": true,
"name": &"idle",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_vgcly")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_am7gf")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_dl7y1")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_k8ndx")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_n4qa5")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_dpvvu")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_3uovp")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_dirde")
}],
"loop": true,
"name": &"roll",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_eeckv")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_73fcm")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_amgoj")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_dl8hg")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_7gbg6")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_fi51b")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_cvy7i")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_52t2v")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_vf7ab")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_hd66r")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_7mdq6")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ttng0")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_vccwk")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_e8esa")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_p4ckx")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_vlntg")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_tv0i6")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_uj4sv")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_1hdpg")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ox8pr")
}],
"loop": true,
"name": &"run",
"speed": 5.0
}]

[sub_resource type="GDScript" id="GDScript_ne7j2"]
resource_name = "MusicPlayer"
script/source = "extends AudioStreamPlayer2D

func _on_player_start():
	self.play()
"

[node name="Player" type="CharacterBody2D"]
z_index = 1
collision_layer = 2
collision_mask = 5
script = SubResource("GDScript_ngihq")

[node name="Camera2D" type="Camera2D" parent="."]
script = SubResource("GDScript_lmkjx")

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2(-0.5, 2.5)
shape = SubResource("RectangleShape2D_1mewk")

[node name="AnimatedSprite2D" type="AnimatedSprite2D" parent="."]
position = Vector2(-4.76837e-07, 4.76837e-07)
sprite_frames = SubResource("SpriteFrames_vulta")
animation = &"roll"
frame_progress = 0.363624

[node name="Timer" type="Timer" parent="."]
wait_time = 2.387
one_shot = true
autostart = true

[node name="AudioStreamPlayer2D" type="AudioStreamPlayer2D" parent="."]
stream = ExtResource("2_fxw2h")
script = SubResource("GDScript_ne7j2")

[node name="HealthController" type="Node" parent="."]
script = ExtResource("3_3k4ky")

[connection signal="hit" from="." to="HealthController" method="_on_player_hit" binds= [1]]
[connection signal="start" from="." to="AudioStreamPlayer2D" method="_on_player_start"]
[connection signal="timeout" from="Timer" to="Camera2D" method="_on_timer_timeout"]
